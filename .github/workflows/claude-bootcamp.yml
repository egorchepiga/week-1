name: Claude Bootcamp Execution

# âš ï¸ Ð’ÐÐ–ÐÐž: Ð­Ñ‚Ð¾Ñ‚ workflow Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð¢ÐžÐ›Ð¬ÐšÐž Ð’Ð Ð£Ð§ÐÐ£Ð®!
# - ÐÐ• Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ… master
# - ÐÐ• Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð¸Ð· Claude Desktop
# - Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ‡ÐµÑ€ÐµÐ· GitHub Actions UI â†’ "Run workflow"

on:
  workflow_dispatch:
    inputs:
      lesson_start:
        description: 'Start from lesson (1-4)'
        required: true
        default: '1'
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '4'
      lesson_end:
        description: 'End at lesson (1-4)'
        required: true
        default: '2'
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '4'
      run_id:
        description: 'Run identifier (optional, e.g., experiment-1)'
        required: false
        default: ''

env:
  ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

jobs:
  execute-bootcamp:
    runs-on: self-hosted
    timeout-minutes: 120

    steps:
      - name: Generate branch name
        id: branch
        run: |
          # Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚: claude/master-manual_YYYYMMDD-HHMMSS Ð¸Ð»Ð¸ claude/master-manual_custom-id
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          RUN_ID="${{ github.event.inputs.run_id }}"
          if [ -n "$RUN_ID" ]; then
            BRANCH_NAME="claude/master-manual_${RUN_ID}"
          else
            BRANCH_NAME="claude/master-manual_${TIMESTAMP}"
          fi
          echo "name=${BRANCH_NAME}" >> $GITHUB_OUTPUT
          echo "Branch: ${BRANCH_NAME}"

      - name: Checkout master
        uses: actions/checkout@v4
        with:
          ref: master
          fetch-depth: 0

      - name: Create working branch
        run: |
          git checkout -b ${{ steps.branch.outputs.name }}
          git push -u origin ${{ steps.branch.outputs.name }}

      - name: Configure Git
        run: |
          git config user.name "Claude Bootcamp Bot"
          git config user.email "bot@bootcamp.local"

      - name: Execute Claude Code
        id: claude
        run: |
          LESSON_START=${{ github.event.inputs.lesson_start }}
          LESSON_END=${{ github.event.inputs.lesson_end }}

          # Build prompt
          PROMPT=$(cat << 'PROMPT_END'
          # Ð—ÐÐ”ÐÐ§Ð: Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Captain Builders Bootcamp

          ## Ð˜ÐÐ˜Ð¦Ð˜ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯ ÐšÐžÐÐ¢Ð•ÐšÐ¡Ð¢Ð

          ### Ð¨Ð°Ð³ 1: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹
          ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð¹ Ñ„Ð°Ð¹Ð»Ñ‹ Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ:

          1. `CLAUDE.md` â€” ÐºÐ¾Ñ€Ð½ÐµÐ²Ð¾Ð¹ entry point, Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°
          2. `PROGRESS.md` â€” Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
          3. `shared/CLAUDE.md` â€” Ð¾Ð±Ñ‰Ð¸Ðµ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ñ‹ Ð¸ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ Ð¾Ñ†ÐµÐ½ÐºÐ¸

          ### Ð¨Ð°Ð³ 2: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð² ÐºÑƒÑ€ÑÐ°
          4. `inputs/CLAUDE.md` â€” Ð¾Ð±Ð·Ð¾Ñ€ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
          5. `inputs/course/CLAUDE.md` â€” ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑƒÑ€Ð¾ÐºÐ¾Ð² ÐºÑƒÑ€ÑÐ°
          6. `inputs/bootcamp-recordings/ERRORS_CATALOG.md` â€” ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐ˜ Ð’ÐÐ–ÐÐž: ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ñ‚Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº
          7. `inputs/bootcamp-recordings/SUMMARY.md` â€” Ð²Ñ‹Ð¶Ð¸Ð¼ÐºÐ° Ð¸Ð· Ñ€Ð°Ð·Ð±Ð¾Ñ€Ð¾Ð²

          ### Ð¨Ð°Ð³ 3: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑƒÑ€Ð¾ÐºÐ¾Ð²
          8. `lesson-01/CLAUDE.md` â€” Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ ÑƒÑ€Ð¾ÐºÐ° 1
          9. `lesson-02/CLAUDE.md` â€” Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ ÑƒÑ€Ð¾ÐºÐ° 2
          10. `lesson-02/keywords/CLAUDE.md` â€” Ð³Ð°Ð¹Ð´ Ð¿Ð¾ Semrush Ð´Ð»Ñ AI

          ## Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ˜Ð•

          ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸ ÑƒÑ€Ð¾ÐºÐ¸ Ð¾Ñ‚ LESSON_START Ð´Ð¾ LESSON_END Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾.

          ### Ð£Ñ€Ð¾Ðº 1: Ð’Ñ‹Ð±Ð¾Ñ€ Ð¸Ð´ÐµÐ¸
          - ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð¹ `inputs/course/parsed/01_vybor_idei.md`, `02_ocenka_dohodnosti.md`, `03_podschet_ballov.md`
          - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ `inputs/app-database/*.xlsx` Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ñ€Ñ‹Ð½ÐºÐ°
          - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð¸Ð´ÐµÐ¸ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¸Ð· `ERRORS_CATALOG.md`
          - Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð² `lesson-01/outputs/`
          - Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¢ÐžÐŸ-3 Ð¸Ð´ÐµÐ¸ Ð´Ð»Ñ ÑƒÑ€Ð¾ÐºÐ° 2

          ### Ð£Ñ€Ð¾Ðº 2: Keyword Research
          - ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð¹ `inputs/course/parsed/04-09_*.md`
          - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Semrush (MCP Playwright) Ð´Ð»Ñ ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
          - Ð¡Ð»ÐµÐ´ÑƒÐ¹ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ñƒ Ð¸Ð· `lesson-02/keywords/CLAUDE.md`
          - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ ÐºÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ‚Ð¾Ð² Ð² `inputs/app-database/*.xlsx`
          - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ ÑÐ¾Ñ„Ñ‚Ð¾Ð²Ð¾ÑÑ‚ÑŒ Ð² Google SERP
          - Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð¿Ð¾ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°Ð¼ Ð¸Ð· `lesson-02/templates/`
          - Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ `lesson-02/outputs/KEYWORD_RESEARCH_REPORT.md`

          ## ÐŸÐ ÐÐ’Ð˜Ð›Ð Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ˜Ð¯

          1. **ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐ¹ PROGRESS.md** Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð·Ð½Ð°Ñ‡Ð¸Ð¼Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð°
          2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹ Ð¸Ð´ÐµÐ¸ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸** Ð¸Ð· ERRORS_CATALOG.md Ð¿ÐµÑ€ÐµÐ´ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÐµÐ¹
          3. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐ¹ Ð²ÑÐµ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹** Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ outputs/ Ð¿Ð°Ð¿ÐºÐ¸
          4. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹** Ð¸Ð· templates/ Ð¿Ð°Ð¿Ð¾Ðº
          5. **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ** Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½Ð½Ð¾Ð³Ð¾ ÑÑ‚Ð°Ð¿Ð°

          ## ÐšÐ Ð˜Ð¢Ð•Ð Ð˜Ð˜ Ð£Ð¡ÐŸÐ•Ð¥Ð

          - [ ] Ð’ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹
          - [ ] Ð£Ñ€Ð¾ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾
          - [ ] ÐžÑ‚Ñ‡Ñ‘Ñ‚Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ð°Ð¿ÐºÐ°Ñ…
          - [ ] PROGRESS.md Ð¾Ð±Ð½Ð¾Ð²Ð»Ñ‘Ð½
          - [ ] Ð˜Ð´ÐµÐ¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ñ‹ Ð½Ð° Ñ‚Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
          - [ ] Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½

          ## Ð¤ÐžÐ ÐœÐÐ¢ ÐšÐžÐœÐœÐ˜Ð¢ÐžÐ’

          ```
          feat(lesson-XX): ÐšÑ€Ð°Ñ‚ÐºÐ¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ

          - Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
          - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹

          ðŸ¤– Generated with Claude Code
          Co-Authored-By: Claude <noreply@anthropic.com>
          ```

          ÐÐ°Ñ‡Ð½Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÐµÐ¹Ñ‡Ð°Ñ.
          PROMPT_END
          )

          # Replace placeholders
          PROMPT="${PROMPT//LESSON_START/$LESSON_START}"
          PROMPT="${PROMPT//LESSON_END/$LESSON_END}"

          echo "Starting Claude Code execution..."
          echo "Lessons: $LESSON_START to $LESSON_END"

          # Execute Claude Code
          claude --print --dangerously-skip-permissions "$PROMPT" 2>&1 | tee claude_output.log

          EXIT_CODE=${PIPESTATUS[0]}
          echo "exit_code=${EXIT_CODE}" >> $GITHUB_OUTPUT

      - name: Commit generated files
        if: always()
        run: |
          git add -A
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "$(cat << 'EOF'
          feat(bootcamp): Auto-generated files from Claude execution

          Lessons: ${{ github.event.inputs.lesson_start }} to ${{ github.event.inputs.lesson_end }}
          Branch: ${{ steps.branch.outputs.name }}
          Run ID: ${{ github.run_id }}

          ðŸ¤– Generated with Claude Code
          Co-Authored-By: Claude <noreply@anthropic.com>
          EOF
          )"
            git push
          fi

      - name: Upload execution log
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: claude-execution-log
          path: claude_output.log
          retention-days: 30

      - name: Create summary
        if: always()
        run: |
          echo "## Bootcamp Execution Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch:** \`${{ steps.branch.outputs.name }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Lessons:** ${{ github.event.inputs.lesson_start }} to ${{ github.event.inputs.lesson_end }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Exit Code:** ${{ steps.claude.outputs.exit_code }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Generated Files" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          git diff --name-only HEAD~1 2>/dev/null || echo "No previous commit to compare"
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

      - name: Check execution status
        if: steps.claude.outputs.exit_code != '0'
        run: |
          echo "::warning::Claude Code exited with code ${{ steps.claude.outputs.exit_code }}"
          echo "Check the execution log for details"
